# Personal Finance App - Implementation Task List

**Date:** 2026-02-01
**Total Tasks:** 97
**Phases:** 8

---

## Phase 1: Foundation (10 tasks)

### 1.1 Initialize Astro project with TypeScript
Create new Astro 5 project with TypeScript, SSR mode enabled, React integration, and proper tsconfig setup. Use `npm create astro@latest` with SSR adapter for Node.

### 1.2 Configure Tailwind CSS 4 and shadcn/ui
Install and configure Tailwind CSS 4 with Astro. Set up shadcn/ui with proper color scheme (dark sidebar, light content). Configure CSS variables for the Kuber-inspired color palette.

### 1.3 Set up Drizzle ORM with SQLite
Install drizzle-orm and better-sqlite3. Create drizzle.config.ts. Set up database connection in src/lib/db/index.ts. Configure migrations directory.

### 1.4 Create User and Household schema
Define Drizzle schema for: User (id, email, name, householdId, role, createdAt, updatedAt), Household (id, name, primaryCurrency, financialYearStart, createdAt, updatedAt). Create initial migration.

### 1.5 Create UserFinancialProfile schema
Define schema for UserFinancialProfile: userId (FK), dateOfBirth, targetRetirementAge, riskTolerance, annualIncome, incomeFrequency, taxBracket, lifeExpectancy, estimatedMonthlyExpense.

### 1.6 Integrate Better Auth with 2FA and passkeys
Install better-auth. Configure with SQLite adapter. Enable email/password, TOTP 2FA, and WebAuthn passkeys. Create auth routes in src/pages/api/auth/[...all].ts. Set up session handling.

### 1.7 Create AuthLayout for login/signup pages
Build AuthLayout.astro - centered card layout for auth pages. Create login page with email/password + passkey option. Create signup page with household creation. Create forgot password flow.

### 1.8 Create AppLayout with sidebar navigation
Build AppLayout.astro with dark sidebar (240px) and light content area. Create Sidebar component with navigation items matching design (Dashboard, Assets section, Liabilities, Management). Add user avatar and sign out at bottom.

### 1.9 Build dashboard shell with placeholder cards
Create dashboard page (src/pages/index.astro). Add placeholder cards for: Net Worth, Total Assets, Total Debts, Real Estate Equity, Runway, Required Monthly Savings. Add empty chart area for net worth trend.

### 1.10 Set up TanStack Query provider
Install @tanstack/react-query. Create QueryClientProvider wrapper for React islands. Set up default query options (staleTime, cacheTime). Create hooks directory structure.

---

## Phase 2: Core Assets (10 tasks)

### 2.1 Create Account base schema (polymorphic)
**Blocked by:** 1.1, 1.2, 1.3, 1.4

Define Account schema: id, householdId (FK), name, type (enum), currency, isActive, isLiquid, expectedAnnualReturnRate, notes, createdAt, updatedAt. Type enum: bank_account, stock, crypto, real_estate, superannuation, personal_asset, business_asset.

### 2.2 Create BankAccount schema and API
Define BankAccount: accountId (FK), bankName, accountNumber (encrypted), accountType (checking/savings/etc), balance. Create API routes: GET /api/bank-accounts, POST /api/bank-accounts, PUT /api/bank-accounts/[id], DELETE /api/bank-accounts/[id].

### 2.3 Build Bank Accounts page UI
Create src/pages/bank-accounts/index.astro. Build account list with TanStack Table. Show total balance header with trend. Add "Add Account" button and modal form. Include edit/delete actions per row.

### 2.4 Create Stock schema and API
Define Stock: accountId (FK), symbol, exchange, shares, avgCostBasis, broker. Create API routes for CRUD. Include calculated fields: currentValue, totalGain, gainPercentage.

### 2.5 Build Stocks & ETFs page UI
Create stocks page with holdings table. Show columns: Symbol, Shares, Avg Cost, Current Price, Value, P/L, P/L%. Add "Refresh Prices" button. Add "Add Stock/ETF" modal with symbol search.

### 2.6 Create Crypto schema and API
Define Crypto: accountId (FK), symbol, network, holdings, avgCostBasis, walletAddress. Create CRUD API routes. Support multiple holdings of same coin (different wallets/exchanges).

### 2.7 Build Crypto page UI
Create crypto page with portfolio view. Group by coin symbol. Show holdings, avg cost, current price, value, P/L. Add network/wallet column. "Add Crypto" modal with coin search.

### 2.8 Create ValuationHistory schema
Define ValuationHistory: id, accountId (FK), date, value, source (manual/api/import), createdAt. Create API to record valuations. Add trigger to record on account value change.

### 2.9 Build value trend charts component
Create reusable ValueTrendChart component using Recharts. Support time range selection (Week, Month, Quarter, Year, All). Fetch data from ValuationHistory. Use on all asset pages.

### 2.10 Implement dashboard net worth calculation
Create API endpoint to calculate total net worth: sum all assets - sum all debts. Handle multi-currency conversion. Update dashboard cards with real data. Show net worth, total assets, total debts.

---

## Phase 3: Extended Assets & Liabilities (12 tasks)

### 3.1 Create RealEstate schema and API
**Blocked by:** 2.1, 2.2

Define RealEstate: accountId (FK), address, propertyType (house/apartment/land/commercial/other), purchasePrice, purchaseDate, currentValue, mortgageId (FK to Debt, nullable). Create CRUD API routes.

### 3.2 Create Debt schema and API
Define Debt: id, householdId, name, type (mortgage/credit_card/personal_loan/student_loan/car_loan/other), currency, lender, originalAmount, currentBalance, interestRate, minimumPayment, paymentDueDay, startDate, endDate, isActive. Create CRUD API.

### 3.3 Build Real Estate page with mortgage linking
Create real-estate page. Show property cards with address, type, value, equity. Calculate equity = currentValue - linked mortgage balance. Allow linking/unlinking mortgages. Add property modal with all fields.

### 3.4 Build Debts page UI
Create debts page. Show debt list with name, type, balance, interest rate, minimum payment. Include payoff progress bar (paid vs original). Group by type. Add "Add Debt" modal.

### 3.5 Create Superannuation schema and API
Define Superannuation: accountId (FK), fundName, memberNumber, balance, employer. Create CRUD API. Include projection calculations based on contribution rate and expected returns.

### 3.6 Build Superannuation page UI
Create superannuation page. Show fund list with balance, employer. Add contribution tracking. Show projected value at retirement based on UserFinancialProfile.targetRetirementAge.

### 3.7 Create PersonalAsset schema and API
Define PersonalAsset: accountId (FK), category (vehicle/jewelry/art/collectible/electronics/other), description, purchasePrice, purchaseDate, currentValue. Create CRUD API.

### 3.8 Create BusinessAsset schema and API
Define BusinessAsset: accountId (FK), businessName, ownershipPercentage, businessType, currentValue, vestingSchedule (JSON). Create CRUD API.

### 3.9 Build Personal Assets page UI
Create personal-assets page. Group items by category. Show item cards with name, category, value. Support image upload for items. Add "Add Asset" modal with category picker.

### 3.10 Build Business Assets page UI
Create business-assets page. Show business cards with name, ownership %, value. Display vesting schedule if applicable. Add "Add Business" modal.

### 3.11 Implement dashboard asset allocation chart
Create donut/pie chart showing asset allocation by type. Calculate percentages: bank accounts, stocks, crypto, real estate, super, personal, business. Add to dashboard. Make segments clickable to navigate to category.

### 3.12 Create UserAccountPermission schema
Define UserAccountPermission: userId (FK), accountId (FK), permissionLevel (readonly/full_access/hidden). Implement permission checks in all account API routes. Filter accounts based on user permissions.

---

## Phase 4: Transactions & Cashflow (14 tasks)

### 4.1 Create Transaction schema
**Blocked by:** 2.1, 3.2

Define Transaction: id, householdId, accountId, importBatchId, date, description, rawDescription, amount, currency, type (income/expense/transfer), categoryId, status (pending/cleared/reconciled), linkedTransactionId, notes, isRecurring, recurringScheduleId, createdAt, updatedAt.

### 4.2 Create TransactionSplit schema
Define TransactionSplit: id, transactionId (FK), categoryId (FK), amount, description. Ensure sum of splits equals parent transaction amount. Create API for managing splits.

### 4.3 Create Category schema with hierarchy
Define Category: id, householdId, name, type (income/expense/transfer), icon, color, parentId (FK for subcategories), isSystem, sortOrder. Seed default categories (Food, Transport, Entertainment, etc.).

### 4.4 Create Tag and TransactionTag schemas
Define Tag: id, householdId, name, color. Define TransactionTag: transactionId, tagId (composite PK). Create API for tag CRUD and assigning tags to transactions.

### 4.5 Create Transaction CRUD API
Build API routes: GET /api/transactions (with filters: date range, category, account, type, tags), POST /api/transactions, PUT /api/transactions/[id], DELETE /api/transactions/[id]. Support split transactions in create/update.

### 4.6 Create ImportBatch schema
Define ImportBatch: id, householdId, accountId, filename, fileType (csv/xlsx/ofx/qif), transactionCount, status (pending/processing/completed/failed), errorMessage, importedAt, createdAt. Track all imports for undo capability.

### 4.7 Build CSV import parser
Create CSV parser supporting common bank formats. Auto-detect columns (date, description, amount, etc.). Handle different date formats. Support debit/credit columns or signed amounts. Preview parsed transactions before import.

### 4.8 Create CategoryRule schema and matching
Define CategoryRule: id, householdId, pattern, patternType (contains/regex/exact), categoryId, priority, isAI, isActive. Implement rule matching on import. Higher priority rules match first.

### 4.9 Build Cashflow page with transaction list
Create cashflow page. Add period selector (This Month, This FY, Custom). Show spending summary cards (Total, Essential, Discretionary, Uncategorized). Build transaction table with TanStack Table - sortable, filterable columns.

### 4.10 Build transaction filters UI
Add filter bar to cashflow page: date range picker, account selector, category multi-select, type filter (income/expense/transfer), tag filter, status filter, search by description. Persist filters in URL params.

### 4.11 Build CSV import UI with preview
Create import modal: file upload, column mapping UI, date format selector, preview table of parsed transactions, category suggestions per row, confirm import button. Show import progress and results.

### 4.12 Build category rules management UI
Create rules management page/modal. List existing rules with pattern, category, priority. Add/edit/delete rules. Test rule against sample descriptions. Reorder rules by priority.

### 4.13 Build spending trends chart
Create spending trends chart on cashflow page. Show spending by category over time (bar or area chart). Support grouping: daily, weekly, monthly. Compare to previous period.

### 4.14 Implement transfer linking
When creating a transfer, auto-create linked transaction in target account. Set linkedTransactionId on both. When editing/deleting one, update/delete the other. Show transfers distinctly in UI.

---

## Phase 5: Budgeting & Goals (12 tasks)

### 5.1 Create Budget schema
**Blocked by:** 4.3, 4.5

Define Budget: id, householdId, categoryId (FK), month (YYYY-MM), amount, rollover (boolean for unused budget). Create API for budget CRUD. Support copying budgets to next month.

### 5.2 Build Budgets page UI
Create budgets page. Show month selector. List categories with: budget amount, spent amount, remaining, progress bar. Color code: green (under), yellow (near), red (over). Add/edit budget amounts inline.

### 5.3 Implement budget vs actual calculation
Create API to calculate spent per category for a month. Sum transactions by categoryId including child categories. Return budget, spent, remaining, percentage. Handle uncategorized spending.

### 5.4 Create Goal schema
Define Goal: id, householdId, name, description, targetAmount, currentAmount, targetDate, category (emergency_fund/house/car/vacation/retirement/education/other), linkedAccountIds (JSON), icon, color, isCompleted, completedAt, createdAt.

### 5.5 Build Goals page UI
Create goals page. Show goal cards with: name, target amount, current amount, progress bar, days remaining. Add "Create Goal" modal with all fields. Allow linking bank accounts to auto-track progress.

### 5.6 Implement goal progress calculation
Calculate goal currentAmount from linked accounts' balances. If no linked accounts, use manual entry. Show progress percentage, amount remaining, projected completion date based on savings rate.

### 5.7 Create InsurancePolicy schema
Define InsurancePolicy: id, householdId, name, type (life/health/home/auto/disability/umbrella/other), provider, policyNumber, premium, premiumFrequency, coverageAmount, deductible, startDate, expiryDate, autoRenew, notes, createdAt.

### 5.8 Build Insurance page UI
Create insurance page. Show summary: active policies count, annual premium total, monthly premium. List policies as cards with: name, type, provider, premium, coverage, expiry. Highlight expiring soon. Add policy modal.

### 5.9 Create RecurringTransactionSchedule schema
Define RecurringTransactionSchedule: id, householdId, accountId, description, amount, categoryId, type, frequency (daily/weekly/fortnightly/monthly/yearly), interval, dayOfWeek, dayOfMonth, startDate, endDate, isActive, lastGeneratedDate.

### 5.10 Build recurring transactions UI
Add recurring transactions management in cashflow. List scheduled transactions with next occurrence. Add/edit/delete schedules. Manual trigger to generate transactions. Show in transaction list with recurring icon.

### 5.11 Create FinancialProjection schema
Define FinancialProjection: id, householdId, description, type (income/expense), amount, frequency (once/monthly/yearly), startDate, endDate, isActive. Use for runway and retirement calculations.

### 5.12 Implement runway calculation
Calculate runway: liquid assets / monthly expenses. Show in dashboard. Consider: liquid assets only (isLiquid=true), average monthly spending from transactions, or estimatedMonthlyExpense from UserFinancialProfile.

---

## Phase 6: AI Integration (11 tasks)

### 6.1 Create AIProvider schema
**Blocked by:** 1.3, 1.4

Define AIProvider: id, householdId, name, provider (openai/anthropic/ollama/custom), baseUrl, apiKey (encrypted), model, isDefault, isActive, createdAt. Store API keys encrypted using a secret from env.

### 6.2 Create AIConversation schema
Define AIConversation: id, householdId, userId, title, messages (JSON array of {role, content, timestamp}), createdAt, updatedAt. Store chat history for context continuity.

### 6.3 Build AI provider settings UI
Create AI settings section: provider dropdown, API key input (masked), base URL (for custom), model selector, test connection button. Show usage stats if available. Save/update configuration.

### 6.4 Integrate Vercel AI SDK
Install ai package (Vercel AI SDK). Create provider abstraction layer supporting OpenAI, Anthropic, Ollama. Configure based on user's AIProvider settings. Handle streaming responses.

### 6.5 Build AI chat panel component
Create collapsible chat panel (slide from right). Show conversation history. Input field with send button. Streaming response display. Suggestion chips for common queries. Clear conversation button.

### 6.6 Create AI context builder
Build function to create context for AI: current net worth, recent transactions, spending by category, account balances, goals progress. Format as system prompt. Respect data limits to avoid token overflow.

### 6.7 Implement natural language query handling
Create API endpoint for chat. Parse user query with context. Handle queries like: "How much did I spend on X?", "What's my net worth?", "Show my top expenses". Return formatted response with data.

### 6.8 Implement AI auto-categorization
On CSV import, send uncategorized transactions to AI with existing categories. AI suggests category for each based on description. Show suggestions in import preview. Learn from user corrections.

### 6.9 Build AI insights dashboard widget
Create AI insights card on dashboard. Generate weekly insights: spending trends, anomalies, savings opportunities. Cache insights to avoid repeated API calls. Refresh button for new insights.

### 6.10 Implement AI budget suggestions
On budgets page, add "Get AI Suggestions" button. AI analyzes spending history and suggests realistic budget amounts per category. Show comparison with current budgets.

### 6.11 Implement AI retirement projections
On profile page, show AI-powered retirement analysis. Based on: age, savings, expenses, assets, expected returns. Project: years to retirement, required savings rate, probability of success.

---

## Phase 7: API Integrations (10 tasks)

### 7.1 Create DataSource schema
**Blocked by:** 1.3, 1.4

Define DataSource: id, householdId, type (stock/crypto/forex/property/metal), provider, apiKey (encrypted, optional), isEnabled, syncFrequency (realtime/hourly/daily), lastSyncAt, createdAt. Manage external API configurations.

### 7.2 Build data sources settings UI
Create data sources section in settings. List available integrations with toggle to enable/disable. API key input where needed. Sync frequency selector. Last sync timestamp. Manual sync button.

### 7.3 Integrate CoinGecko API for crypto prices
Create CoinGecko client. Fetch prices for user's crypto holdings. Map symbols to CoinGecko IDs. Cache responses (5 min TTL). Update crypto valuations on sync. Handle rate limiting.

### 7.4 Integrate Yahoo Finance API for stock prices
Create Yahoo Finance client (using yahoo-finance2 package). Fetch quotes for user's stock symbols. Get current price, day change, 52-week range. Update stock valuations. Handle market hours.

### 7.5 Create ExchangeRate schema and sync
Define ExchangeRate: id, fromCurrency, toCurrency, rate, date, source. Integrate Frankfurter API. Daily sync of major currency pairs. Store historical rates. Use for multi-currency conversions.

### 7.6 Implement multi-currency conversion
Create currency conversion utility. Convert any amount to household's primary currency. Use latest exchange rate. Support historical conversions for past transactions. Show original + converted amounts in UI.

### 7.7 Integrate Metals.dev API for precious metals
Create metals price client. Fetch gold, silver, platinum prices. Support different units (oz, gram). Update personal asset valuations for metal type. Daily sync.

### 7.8 Create NetWorthSnapshot schema and daily job
Define NetWorthSnapshot: id, householdId, date, totalAssets, totalLiabilities, netWorth, breakdown (JSON by asset type). Create daily job to snapshot net worth. Use for fast historical charts.

### 7.9 Create MonthlyAnalyticsRollup schema and job
Define MonthlyAnalyticsRollup: id, householdId, month, categoryId, totalIncome, totalExpense, transactionCount. Create job to aggregate monthly data. Use for fast reporting queries.

### 7.10 Implement refresh prices button
Add "Refresh Prices" button on stocks and crypto pages. Trigger API calls for all holdings. Show loading state. Update valuations. Record in ValuationHistory. Show last updated timestamp.

---

## Phase 8: Polish & PWA (18 tasks)

### 8.1 Implement mobile responsive sidebar
**Blocked by:** 1.8, 1.9

Make sidebar collapse to hamburger menu on mobile (<768px). Add slide-out drawer behavior. Create bottom navigation bar for mobile with key actions. Ensure touch-friendly tap targets.

### 8.2 Make all pages mobile responsive
Review all pages for mobile responsiveness. Tables become stacked cards on mobile. Charts resize appropriately. Forms stack vertically. Modal sheets from bottom on mobile. Test on various screen sizes.

### 8.3 Configure PWA manifest
Create manifest.json with app name, icons (multiple sizes), theme color, background color, display: standalone. Add to HTML head. Generate icons in required sizes (192x192, 512x512, etc.).

### 8.4 Implement service worker for offline support
Create service worker with Workbox. Cache static assets, API responses. Implement offline fallback page. Handle background sync for offline transactions. Show offline indicator in UI.

### 8.5 Create Notification schema
Define Notification: id, householdId, userId, type (bill_reminder/goal_milestone/budget_alert/price_alert/insurance_renewal/system), title, message, actionUrl, isRead, readAt, createdAt. Create API for notifications.

### 8.6 Build notifications UI
Add notification bell icon in header. Show unread count badge. Dropdown with notification list. Mark as read on click. "Mark all as read" button. Notifications page with full history.

### 8.7 Implement notification generators
Create jobs to generate notifications: bill due reminders (from recurring transactions), goal milestones (25%, 50%, 75%, 100%), budget alerts (80%, 100% spent), insurance renewal (30, 7, 1 days before).

### 8.8 Implement data export (JSON/CSV)
Create export functionality in settings. Export options: all data (JSON), transactions (CSV), accounts (CSV). Include date range filter for transactions. Generate downloadable file. Show export progress.

### 8.9 Implement data backup and restore
Create full backup: export entire SQLite database as downloadable file. Restore from backup file with confirmation. Warn about data replacement. Validate backup file before restore.

### 8.10 Build profile page with financial settings
Create profile page. Tabs: Account (name, email, password change, 2FA setup, passkeys), Financial Profile (all UserFinancialProfile fields), Household (members, invite, remove). Edit inline.

### 8.11 Build settings page
Create comprehensive settings page. Sections: Display (currency, date format, theme), Data Sources (API integrations), AI Provider, Notifications (email preferences), Danger Zone (export, delete account).

### 8.12 Create Dockerfile and docker-compose.yml
Create multi-stage Dockerfile: build stage (npm ci, npm run build), production stage (minimal node image, copy dist). Create docker-compose.yml with volume for SQLite persistence, env vars, health check.

### 8.13 Write README with setup instructions
Create comprehensive README: project description, features list, screenshots, quick start (Docker), manual setup, environment variables, configuration options, contributing guide, license (choose open source).

### 8.14 Add keyboard shortcuts and command palette
Implement Cmd+K command palette for quick navigation and actions. Add keyboard shortcuts: g+d (go to dashboard), g+t (transactions), n (new transaction), / (search). Show shortcut hints in UI.

### 8.15 Implement quick add floating action button
Add floating action button (FAB) in bottom right. Expand to show: Add Transaction, Add Asset, Add Goal. Animate expansion. Hide on scroll down, show on scroll up. Mobile-friendly positioning.

### 8.16 Performance optimization and testing
Audit performance with Lighthouse. Optimize: lazy load charts, virtualize long lists, optimize images, minimize bundle size. Add loading skeletons. Target 90+ Lighthouse score. Test with large datasets.

### 8.17 Security audit and hardening
Review security: ensure all API routes check authentication, validate all inputs with Zod, sanitize outputs, check CSRF protection, audit encryption of sensitive fields, rate limit auth endpoints, security headers.

### 8.18 Create demo data seeder
Create script to seed demo data: sample household, accounts of each type, 6 months of transactions, goals, budgets. Use for testing and screenshots. Option to run on first setup.

---

## Summary

| Phase | Tasks | Focus |
|-------|-------|-------|
| 1 | 10 | Foundation (Astro, DB, Auth, Layout) |
| 2 | 10 | Core Assets (Bank, Stocks, Crypto) |
| 3 | 12 | Extended Assets & Liabilities |
| 4 | 14 | Transactions & Cashflow |
| 5 | 12 | Budgeting & Goals |
| 6 | 11 | AI Integration |
| 7 | 10 | API Integrations |
| 8 | 18 | Polish & PWA |
| **Total** | **97** | |

---

## Dependencies

- Phase 2 depends on Phase 1 completion (especially 1.1-1.4)
- Phase 3 depends on Phase 2.1 (Account base schema)
- Phase 4 depends on Phase 2.1 and 3.2 (Account and Debt schemas)
- Phase 5 depends on Phase 4.3 and 4.5 (Category and Transaction schemas)
- Phase 6 depends on Phase 1.3 and 1.4 (DB setup)
- Phase 7 depends on Phase 1.3 and 1.4 (DB setup)
- Phase 8 depends on Phase 1.8 and 1.9 (Layout components)
